<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Basque</title>

    </head>
    <body>
        <button data-platform="linux">basque.linux.zip</a>
        <button data-platform="mac">basque.mac.zip</a>
        <button data-platform="windows">basque.windows.zip</a>
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('https://api.github.com/repos/ryanpcmcquen/basque/actions/artifacts')
                .then((res) => {
                    return res.json();
                })
                .then((json) => {
                    let download_urls = {};
                    json.artifacts.some((artifact) => {
                        switch (artifact.name) {
                            case 'basque.linux.zip':
                                download_urls.linux = artifact.archive_download_url;
                                break;
                            case 'basque.mac.zip':
                                download_urls.mac = artifact.archive_download_url;
                                break;
                            case 'basque.windows.zip':
                                download_urls.windows = artifact.archive_download_url;
                                break;
                            default:
                                break;
                        }
                        if (
                            download_urls.linux &&
                            download_urls.mac &&
                            download_urls.windows
                        ) {
                            return true;
                        }
                    });

                    Object.keys(download_urls).forEach((platform) => {
                        document.querySelector(`[data-platform="${platform}"]`).onClick =
                            () => {
                                fetch(
                                    `download_urls[platform]`,
                                    {
                                        headers: {
                                            Authorization: 'token 62794b3472d5f0749c774b8b671de292193e4268'
                                        }
                                    }
                                )
                            }
                    });
                });
        });
        </script>
    </body>
</html>
